(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{231:function(t,e,o){(function(e){var o=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,n=/^0o[0-7]+$/i,c=parseInt,d="object"==typeof e&&e&&e.Object===Object&&e,v="object"==typeof self&&self&&self.Object===Object&&self,f=d||v||Function("return this")(),_=Object.prototype.toString,m=Math.max,h=Math.min,x=function(){return f.Date.now()};function S(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function y(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==_.call(t)}(t))return NaN;if(S(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=S(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var d=l.test(t);return d||n.test(t)?c(t.slice(2),d?2:8):r.test(t)?NaN:+t}t.exports=function(t,e,o){var r,l,n,c,d,v,f=0,_=!1,w=!1,O=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function P(time){var e=r,o=l;return r=l=void 0,f=time,c=t.apply(o,e)}function k(time){return f=time,d=setTimeout(C,e),_?P(time):c}function j(time){var t=time-v;return void 0===v||t>=e||t<0||w&&time-f>=n}function C(){var time=x();if(j(time))return $(time);d=setTimeout(C,function(time){var t=e-(time-v);return w?h(t,n-(time-f)):t}(time))}function $(time){return d=void 0,O&&r?P(time):(r=l=void 0,c)}function T(){var time=x(),t=j(time);if(r=arguments,l=this,v=time,t){if(void 0===d)return k(v);if(w)return d=setTimeout(C,e),P(v)}return void 0===d&&(d=setTimeout(C,e)),c}return e=y(e)||0,S(o)&&(_=!!o.leading,n=(w="maxWait"in o)?m(y(o.maxWait)||0,e):n,O="trailing"in o?!!o.trailing:O),T.cancel=function(){void 0!==d&&clearTimeout(d),f=0,r=v=l=d=void 0},T.flush=function(){return void 0===d?c:$(x())},T}}).call(this,o(27))},282:function(t,e,o){var content=o(327);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(25).default)("449f59dd",content,!0,{sourceMap:!1})},293:function(t,e,o){"use strict";o.r(e);o(44),o(16),o(17),o(8),o(34),o(20);var r=o(2),l=(o(21),o(26),o(10)),n=o(35),c=o(231),d=o.n(c);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function f(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(l.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var _={props:{sold:{type:Object,default:function(){}}},data:function(){return{localSold:{discount:0,card:null,products:[],seller:[],totalPrice:0,date:""},buyer:{cardCode:"",name:""},product:"",products:[],debounceSerch:null,debounceSerchCard:null,debounceSerchProduct:null}},computed:f(f({},Object(n.b)({sellers:"codeBooks/sellers"})),{},{getOnlySeller:function(){return this.sellers.filter((function(t){return"manager"===t.role.key}))},getTotalPrice:function(){var t=this,e=this.localSold.products.reduce((function(e,o){return e+(o.discount<50&&t.localSold.discount?o.priseSold-o.priseSold/100*t.localSold.discount:o.priseSold)}),0);return Math.round(e)},getTotalIncome:function(){var t=this,e=this.localSold.products.reduce((function(e,o){return e+((o.discount<50&&t.localSold.discount?o.priseSold-o.priseSold/100*t.localSold.discount:o.priseSold)-o.priceIn)}),0);return Math.round(e)},getTotalOut:function(){var t=this.localSold.products.reduce((function(t,e){return t+e.priceIn}),0);return Math.round(t)}}),created:function(){this.debounceSerchCard=d()(this.getDiscountCard,1e3),this.debounceSerchProduct=d()(this.getProduct,1e3),this.localSold.date=new Date,this.sold&&(this.localSold=f(f({},this.localSold),this.sold),this.sold.card&&(this.buyer.cardCode=this.sold.card.code,this.buyer.name=this.sold.card.name))},methods:{updateTotalPrice:function(){this.localSold.totalPrice=this.getTotalPrice},getDiscountCard:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/admin/discount-cards",{params:{code:t.buyer.cardCode}});case 3:o=e.sent,r=o.data.discountCards[0],t.buyer.name=r.name,t.localSold.card=r._id,t.localSold.discount=r.discount,t.localSold.totalPrice=t.getTotalPrice,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},getProduct:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/admin/products",{params:{search:t.product,limit:100,page:1}});case 3:o=e.sent,r=o.data.products,t.products=r,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},addProduct:function(t){var e=JSON.parse(JSON.stringify(t)),o=e.priceOut/100*e.discount;e.dateOut=this.localSold.date,e.priseSold=e.priceOut-o,e.visibility=!1,this.localSold.products.push(e),this.products=[],this.product="",this.localSold.totalPrice=this.getTotalPrice},deleteProduct:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,!e.localSold._id){o.next=11;break}return r=e.localSold.products[t],e.localSold.products.splice(t,1),e.localSold.totalPrice=e.getTotalPrice,o.next=7,e.$axios.put("/admin/solds/".concat(e.localSold._id),e.localSold);case 7:return o.next=9,e.$axios.put("/admin/products/".concat(r._id),{dateOut:null,priseSold:0,visibility:!0});case 9:o.next=12;break;case 11:e.localSold.products.splice(t,1);case 12:e.localSold.totalPrice=e.getTotalPrice,o.next=18;break;case 15:o.prev=15,o.t0=o.catch(0),console.log(o.t0);case 18:case"end":return o.stop()}}),o,null,[[0,15]])})))()},saveSold:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.localSold.totalIncome=t.getTotalIncome,t.localSold.totalOut=t.getTotalOut,!t.localSold._id){e.next=8;break}return e.next=6,t.$axios.put("/admin/solds/".concat(t.localSold._id),t.localSold);case 6:e.next=10;break;case 8:return e.next=10,t.$axios.post("/admin/solds",t.localSold);case 10:t.$router.push("/admin-panel/sold"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()}}},m=(o(326),o(6)),component=Object(m.a)(_,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"sold-form__wrapper"},[o("div",{staticClass:"sold-form"},[o("h3",[t._v("Продавец:")]),t._v(" "),t._l(t.getOnlySeller,(function(e){return o("label",{key:e._id,staticClass:"seller"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.localSold.seller,expression:"localSold.seller"}],attrs:{type:"checkbox"},domProps:{value:e._id,checked:Array.isArray(t.localSold.seller)?t._i(t.localSold.seller,e._id)>-1:t.localSold.seller},on:{change:function(o){var r=t.localSold.seller,l=o.target,n=!!l.checked;if(Array.isArray(r)){var c=e._id,d=t._i(r,c);l.checked?d<0&&t.$set(t.localSold,"seller",r.concat([c])):d>-1&&t.$set(t.localSold,"seller",r.slice(0,d).concat(r.slice(d+1)))}else t.$set(t.localSold,"seller",n)}}}),t._v("\n      "+t._s(e.name)+"\n    ")])})),t._v(" "),o("div",{staticClass:"sold-form__buyer"},[o("label",[t._v("\n        Дисконтрая карта\n        "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.buyer.cardCode,expression:"buyer.cardCode"}],attrs:{type:"text"},domProps:{value:t.buyer.cardCode},on:{input:[function(e){e.target.composing||t.$set(t.buyer,"cardCode",e.target.value)},t.debounceSerchCard]}})]),t._v(" "),o("label",[t._v("\n        ФИО покупателя\n        "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.buyer.name,expression:"buyer.name"}],attrs:{type:"text",disabled:""},domProps:{value:t.buyer.name},on:{input:function(e){e.target.composing||t.$set(t.buyer,"name",e.target.value)}}})]),t._v(" "),o("label",[t._v("\n        Скидка покупателя\n        "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.localSold.discount,expression:"localSold.discount"}],attrs:{type:"text",disabled:""},domProps:{value:t.localSold.discount},on:{input:function(e){e.target.composing||t.$set(t.localSold,"discount",e.target.value)}}})])]),t._v(" "),o("div",{staticClass:"sold-form__product-list"},[o("label",[t._v("\n        Товар\n        "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.product,expression:"product"}],attrs:{type:"text"},domProps:{value:t.product},on:{input:[function(e){e.target.composing||(t.product=e.target.value)},t.debounceSerchProduct]}})]),t._v(" "),o("table",{directives:[{name:"show",rawName:"v-show",value:t.products.length,expression:"products.length"}],staticClass:"sold-form__product-table"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._l(t.products,(function(e){return o("tr",{key:e._id},[o("td",[t._v("\n            "+t._s(e.category?e.category.name:"")+"\n          ")]),t._v(" "),o("td",[t._v("\n            "+t._s(e.name)+"\n          ")]),t._v(" "),o("td",[t._v("\n            "+t._s(e.priceOut)+"\n          ")]),t._v(" "),o("td",[t._v("\n            "+t._s(e.size)+"\n          ")]),t._v(" "),o("td",[t._v("\n            "+t._s(e.codeProduct)+"\n          ")]),t._v(" "),o("td",[t._v("\n            "+t._s(e.codeBox)+"\n          ")]),t._v(" "),o("td",[o("button",{staticClass:"link",on:{click:function(o){return t.addProduct(e)}}},[t._v("+")])])])}))],2)]),t._v(" "),o("div",{staticClass:"sold-form__table-wrapper"},[o("div",{staticClass:"sold-form__title"},[o("h3",[t._v("Продаваемый товар на сумму")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.localSold.totalPrice,expression:"localSold.totalPrice"}],attrs:{type:"text"},domProps:{value:t.localSold.totalPrice},on:{input:function(e){e.target.composing||t.$set(t.localSold,"totalPrice",e.target.value)}}})]),t._v(" "),o("table",{staticClass:"sold-form__table"},[o("tr",[o("th",{attrs:{width:"250px"}},[t._v("Название")]),t._v(" "),o("th",{attrs:{width:"120px"}},[t._v("Цена витрины")]),t._v(" "),o("th",{attrs:{width:"120px"}},[t._v("Цена продажи")]),t._v(" "),o("th",{attrs:{width:"120px"}},[t._v("Дисконт товара")]),t._v(" "),o("th",[t._v(t._s(t.localSold._id?"Возврат":"Удалить"))])]),t._v(" "),t._l(t.localSold.products,(function(e,r){return o("tr",{key:e._id},[o("td",[t._v("\n            "+t._s(e.name)+"\n          ")]),t._v(" "),o("td",[t._v("\n            "+t._s(e.priceOut)+"\n          ")]),t._v(" "),o("td",[o("input",{directives:[{name:"model",rawName:"v-model",value:e.priseSold,expression:"item.priseSold"}],attrs:{type:"text"},domProps:{value:e.priseSold},on:{change:t.updateTotalPrice,input:function(o){o.target.composing||t.$set(e,"priseSold",o.target.value)}}})]),t._v(" "),o("td",[t._v("\n            "+t._s(e.discount)+"\n          ")]),t._v(" "),o("td",[o("button",{staticClass:"link",on:{click:function(e){return t.deleteProduct(r)}}},[t._v("X")])])])}))],2)])],2),t._v(" "),o("div",{staticClass:"sold-form__actions"},[o("button",{on:{click:t.saveSold}},[t._v("Сохранить")])])])}),[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("tr",[o("th",{attrs:{rowspan:"2",width:"100px"}},[t._v("Тип")]),t._v(" "),o("th",{attrs:{rowspan:"2",width:"250px"}},[t._v("Название")]),t._v(" "),o("th",{attrs:{rowspan:"2",width:"80px"}},[t._v("Цена")]),t._v(" "),o("th",{attrs:{rowspan:"2",width:"60px"}},[t._v("Размер")]),t._v(" "),o("th",{attrs:{colspan:"2"}},[t._v("Штрих код")]),t._v(" "),o("th",{attrs:{rowspan:"2"}},[t._v("Добавить")])])},function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("tr",[o("th",{attrs:{width:"130px"}},[t._v("Товара")]),t._v(" "),o("th",{attrs:{width:"130px"}},[t._v("Коробка")])])}],!1,null,"07c65424",null);e.default=component.exports},326:function(t,e,o){"use strict";o(282)},327:function(t,e,o){var r=o(24)(!1);r.push([t.i,".sold-form[data-v-07c65424]{margin-top:20px;display:flex;flex-direction:column}.sold-form h3[data-v-07c65424]{margin:0}.sold-form__title h3[data-v-07c65424]{display:inline-block;margin-right:10px}.sold-form .seller[data-v-07c65424]{display:flex;align-items:center;padding:3px 0}.sold-form .seller input[data-v-07c65424]{margin-right:10px}.sold-form__buyer[data-v-07c65424]{margin-top:20px;display:flex}.sold-form__buyer label[data-v-07c65424]{width:250px;display:flex;flex-direction:column;margin-right:10px}.sold-form__product-list[data-v-07c65424]{margin-top:20px}.sold-form__product-list label[data-v-07c65424]{width:200px;display:flex;flex-direction:column;margin-bottom:10px}.sold-form__product-table[data-v-07c65424],.sold-form__table[data-v-07c65424]{border-spacing:0;border-collapse:collapse}.sold-form__product-table tr[data-v-07c65424]:hover,.sold-form__table tr[data-v-07c65424]:hover{background-color:#eee}.sold-form__product-table td[data-v-07c65424],.sold-form__product-table th[data-v-07c65424],.sold-form__table td[data-v-07c65424],.sold-form__table th[data-v-07c65424]{border:1px solid #000;padding:5px;text-align:center}.sold-form__product-table td .link[data-v-07c65424],.sold-form__product-table th .link[data-v-07c65424],.sold-form__table td .link[data-v-07c65424],.sold-form__table th .link[data-v-07c65424]{text-decoration:underline;cursor:pointer;background-color:initial;border:none}.sold-form__table-wrapper[data-v-07c65424]{margin-top:20px}.sold-form__table-wrapper h3[data-v-07c65424]{margin-bottom:10px}.sold-form__actions[data-v-07c65424]{margin-top:20px}",""]),t.exports=r}}]);